## 1일차

### 프로젝트 개요

- 주제: 시계열 데이터 기반 **상품 판매량 예측**
- 배경 소개 및 비즈니스 상황
    - 미국 전역에 매장이 있는 유통 회사 K-Mart → **과재고와 재고 부족 문제** 존재
        - 수요가 많거나 급증하는 상품 : 재고 부족
        - 수요가 적거나 급감하는 상품 : 과재고
        - 재고 = 자산, 재고가 많이 남으면 자산이 묶여있음 → 좋지 못한 상황
    - 새로운 해결책: AI 기반 수요량 예측 시스템
        - 가장 매출이 높은 **44번 매장**에 대해 파일럿 프로젝트 진행
        - **핵심 상품 3개**를 선정하고, 이들에 대한 수요 예측을 기반 발주 시스템 가능성 검토
    - 기본 비즈니스 절차
        - **매일 저녁 9시에 매장 업무 마감**
        - 발주 담당자: 당일 및 최근 판매량과 리드 타임(발주(상품 주문) 후 입고까지 기간)에 기초하여 발주(**매일 저녁 10시에 주문**)
        - 발주 후 상품은 각각의 리드 타임에 맞게 입고
- 문제 정의: 고객사의 주요 매장(ID - 44)의 핵심 상품에 대한 수요량을 예측하고 재고를 최적화
- 평가 : **일 평균 재고액 = (일 기초재고 + 일 기말재고) / 2 * (판매가 50%)**

### 데이터 셋 소개

- sales(판매), products(상품), stores(매장), orders(고객 방문 수 = 구매 고객 수), oil_price(일별 유가)

### 과제 요구 사항

- Target 정의
    - ex) 해당 날짜의 target은 **해당 제품의 리드 타임 일수 만큼 경과한 날의 판매량**
- 데이터 탐색
    - 시계열 패턴을 찾기
        - 라인차트를 이용해서, 시간의 흐름에 따른 패턴을 찾기
        - 찾은 패턴 → 데이터셋의 칼럼과 timestep 수 결정에 활용
    - 다양한 기간으로 탐색
        - 전체 기간 : 3년 동안의 긴 기간 흐름을 파악
        - 일부 기간 : 좀 더 짧은 기간 흐름을 파악
    - 여러 요인 비교하기
        - 기간에 따라, 판매량과 다른 요인들과 비교하여 관련이 있는지 확인
- [참조] 마트를 이용하는 고객 관점에서 생각해 보기
    - 일별 휘발유 가격
        - 휘발유 가격이 조금씩 오르거나 내릴 수록 마트 방문 횟수, 혹은 구매수량이 조금씩 달라질 것인가?
        - 아니면, 최근 휘발유 가격이 높거나 아니면 낮은 정도(범주)에 따라 방문횟수 혹은 구매량에 영향을 줄 것인가?
    - 같은 매장 지역 고객 방문객수
        - 같은 지역 매장의 고객 방문객 수가 증가하면, 44번 매장도 증가할까?
        - 아니면 내려가거나 상관이 없을까?

### 추가 자료

- 시계열 데이터 분해(Decomposition)
    - Trend : 큰 흐름 패턴, 추세 → 이동 평균
    - Seasonal : 기간에 따른 사이클(반복 패턴) → 패턴은 지정한 기간내의 패턴을 나타냄
    - Residual : 시계열 모델의 잔차(화이트 노이즈) → 아무런 패턴 X
    - Original = Trend + Seasonal + Residual

### 정리

- `sns.lineplot` 으로 시계열 데이터의 추이를 보도록 하자
- 각각 함수를 구현하여 보기
- 전 단계와의 차이 변수는 유용한 정보를 가지고 있을 수 있음

## 2일차

### 추가 정보

- 분석 단위: (하루, 일별 판매 품목)
- 3, 12, 42번 품목 → 리드 타임 2일
    - y를 2일 후의 각 품목의 판매량으로 정하면 된다
- 보고서 받는 대상: 고객사의 데이터 분석 팀장

### 데이터 전처리

- weekday, 요일별 평균 판매량, 고객 방문수, 판매량 7일 이동 평균 변수 추가
- 3, 12, 42번 제품 별로 각각의 데이터셋 생성

### 잔차 분석

- 정의
    - 시계열 모델을 적용한 후에 모델이 데이터에 얼마나 잘 맞는 지를 평가하는 과정
    - 이 과정에서는 모델로부터 얻은 잔차(예측 값과 실제 값의 차이)에 대해 여러 가정을 검토하고, 이를 통해 모델의 적절성을 판단
- 수행 단계
    1. **정규성 검정**
        - 잔차들이 정규 분포를 따르는지 확인
        - Shapiro-Wilk 테스트와 같은 통계적 검정을 사용하여 정규성을 평가 (일반적으로 p-value가 0.05보다 크면 정규성 가정 만족)
    2. **정상성 검정**
        - 시계열 데이터의 정상성(stationarity): 시간에 따라 평균이 일정하고 분산이 시간에 따라 일정한지를 의미
        - 잔차가 정상성을 만족하는지를 확인하기 위해 Augmented Dickey-Fuller 검정(ADF 검정)과 같은 통계적 검정을 사용 (일반적으로 p-value가 0.05보다 작으면 시계열 데이터가 정상성을 만족 X)
    3. **자기상관성 확인**
        - 잔차의 자기상관성(autocorrelation) 평가
        - 시계열 데이터의 잔차가 자기상관성을 가지는 경우, 모델이 데이터의 일부 구조를 잡아내지 못했거나 모델이 완전하지 않다는 것을 의미
        - 자기상관함수(ACF)와 부분자기상관함수(PACF)를 사용하여 잔차의 자기상관성을 시각적으로 확인 가능

### 스케일링

- X
    - 거리 계산 알고리즘 : KNN, SVM, K-MEANS
    - DL : 학습 속도(최적화) → 오차가 최저점으로 수렴하는 속도
- y
    - ML : X(sklearn, …)
    - DL : y가 `수십` 이상의 수이면 보통 스케일링 → 학습 속도 때문

### 시계열 데이터를 위한 Cross Validation

- Forward Chaining

## 3일차

### 평가

- 결과 보고서
    - 보고서 길이 3 ~ 4장으로 제한
    - DS 팀장님에게 보고

- 데이터 파이프라인 구축
    - 각각의 5개의 데이터셋이 들어오면 모델에서 사용 가능한 형태로 만드는 함수 생성

- 학습 결과
    - LSTM 모델이 CNN모델보다 성능이 좋음
    - 3번 제품(LSTM )
        - RMSE: 2790.83, MAE : 1919.23, MAPE: 9.053514349541678e+17, R2  : 0.51
    - 12번 제품(LSTM)
        - RMSE: 2768.24, MAE : 1754.43, MAPE: 1.1882827514662006e+18, R2  : 0.38
    - 42번 제품(LSTM)
        - RMSE: 11.57, MAE : 9.04, MAPE: 0.11, R2  : 0.42

- 비즈니스 평가
    - 재고 금액 평가
        - 기회 손실 수량은 0이 되는 최소의 안전 재고 설정 → 이때의 일평균 재고 금액 확인
        - 3번 제품
            - 안전 재고 : 2216, 제품 가격: 8
            - 일평균 재고량 : 10293.4, 일평균 재고 금액 : 82347.2, 일평균 재고 회전율 : 1.204, 기회 손실 수량 : 0.0
        - 12번 제품
            - 안전 재고 : 4110, 제품 가격: 6
            - 일평균 재고량 : 10953.775, 일평균 재고 금액 : 65722.65, 일평균 재고회전율 : 1.084, 기회손실 수량     : 0.0
        - 42번 제품
            - 안전 재고 : 36, 제품 가격: 5
            - 일평균 재고량 : 94.2, 일평균 재고 금액 : 471.0, 일평균 재고회전율 : 1.235, 기회손실 수량     : 0.0

### 느낀점

- 시계열 데이터 예측 모델링에서는 날짜의 요소가 중요했고, 추이를 확인해보는 것이 중요하다
- 더 많은 데이터가 있었다면 좋은 성능의 모델을 만들 수 있었을 것 같다